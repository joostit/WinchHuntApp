
@inject IJSRuntime jsRuntime
@inject IMapService mapService

@inject GeoLocationService locationService

@using BrowserInterop.Extensions
@using BrowserInterop.Geolocation
@using WinchHuntApp.Client.Services
@using GoogleMapsComponents
@using GoogleMapsComponents.Maps

@page "/sitemap"

<div ref="mapDiv"
     id="mapDivId"
     style="        
        height: 90vh;
        top: 50px;
        bottom: 50px;
        left: 5%;
        right: 5%;
        background-color: yellow">

    <GoogleMap @ref="@map" Id="map1" Options="@mapOptions" Height="100%"></GoogleMap>

</div>

@code {

    private ElementReference mapDiv;
    private GoogleMap map;
    private MapOptions mapOptions;



    protected override async Task OnInitializedAsync()
    {

        InitMap();
        locationService.GeoLocationStateHasChanged += LocationUpdated;
    }


    private void LocationUpdated(object s, EventArgs e)
    {
        Console.WriteLine("SiteMap: Location Updated");
        var loc = locationService.CurrentPosition;
        Console.WriteLine($"Lat: {loc.Location.Coords.Latitude}, {loc.Location.Coords.Longitude} - Accuracy: {loc.Location.Coords.Accuracy}" );
    }


    private void InitMap()
    {
        mapOptions = new MapOptions()
        {
            Zoom = 13,
            Center = new LatLngLiteral()
            {
                Lat = 13.505892,
                Lng = 100.8162
            },
            MapTypeId = MapTypeId.Roadmap
        };
    }


    protected override async Task OnParametersSetAsync()
    {

    }



    //private async Task GeoLocationUpdated(GeolocationResult location)
    //{

    //    if (location.IsSuccess)
    //    {

    //        GeolocationCoordinate position = new GeolocationCoordinate(52.270088, 6.876613); //new GeolocationCoordinate(location.Coordinates.Latitude, location.Coordinates.Longitude);

    //        if (currentLocationMarker == null)
    //        {
    //            currentLocationMarker = CreateLocationMarker(position);
    //            googleMap.Markers.Add(currentLocationMarker);
    //        }
    //        else
    //        {
    //            currentLocationMarker.Position = position;
    //        }

    //        Console.WriteLine("GeoLocation result is true");
    //        Console.WriteLine($"Result: {location.ToString()}");
    //    }
    //}

    //private GoogleMapMarker CreateLocationMarker(GeolocationCoordinate position)
    //{

    //    GoogleMapMarker retVal = new GoogleMapMarker(position);

    //    retVal.Icon = new GoogleMapMarkerLabelIcon("/img/currentlocation.png")
    //    {
    //        Anchor = new Point()
    //        {
    //            X = 10,
    //            Y = 10
    //        },
    //        Size = new Rect()
    //        {
    //            Width = 40,
    //            Height = 40
    //        },
    //        ScaledSize = new Rect()
    //        {
    //            Width  = 20,
    //            Height = 20
    //        }
    //    };


    //    return retVal;
    //}



    //private async Task OnMapZoomLevelChanged()
    //{

    //}


}
